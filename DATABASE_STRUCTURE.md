# üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Supabase / Postgres)

## –¢–∞–±–ª–∏—Ü—ã

### 1. `public.orders` ‚Äî –ó–∞–∫–∞–∑—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

| –ö–æ–ª–æ–Ω–∫—É            | –¢–∏–ø           | –û–ø–∏—Å–∞–Ω–∏–µ                                             |
| :----------------- | :------------ | :--------------------------------------------------- |
| `id`               | `uuid`        | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (Primary Key)               |
| `order_id`         | `text`        | –ü—É–±–ª–∏—á–Ω—ã–π ID –∑–∞–∫–∞–∑–∞ (–Ω–∞–ø—Ä. ORDER-1735...)            |
| `user_id`          | `uuid`        | –°—Å—ã–ª–∫–∞ –Ω–∞ auth.users.id (nullable –¥–ª—è –≥–æ—Å—Ç–µ–π)        |
| `user_email`       | `text`        | Email –¥–ª—è —á–µ–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π                         |
| `user_phone`       | `text`        | –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞                                      |
| `user_name`        | `text`        | –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞                                          |
| `items`            | `jsonb`       | –ú–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤: `[{id, name, price, quantity, ...}]` |
| `subtotal`         | `numeric`     | –°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –¥–æ—Å—Ç–∞–≤–∫–∏                           |
| `shipping`         | `numeric`     | –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏                                   |
| `total`            | `numeric`     | –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ                              |
| `delivery_method`  | `text`        | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏                            |
| `delivery_address` | `text`        | –¢–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –∏–ª–∏ –∞–¥—Ä–µ—Å –ü–í–ó                           |
| `payment_url`      | `text`        | –°—Å—ã–ª–∫–∞ –Ω–∞ —à–ª—é–∑ –¢–∏–Ω—å–∫–æ—Ñ—Ñ                              |
| `payment_id`       | `text`        | ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –±–∞–Ω–∫–∞                        |
| `status`           | `text`        | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (—Å–º. –Ω–∏–∂–µ)                            |
| `created_at`       | `timestamptz` | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                                        |

#### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞ (`status`):

- `pending_payment` ‚Äî –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã (—Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `paid` ‚Äî –û–ø–ª–∞—á–µ–Ω (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –≤–µ–±—Ö—É–∫–æ–º)
- `payment_failed` ‚Äî –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
- `processing` ‚Äî –í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ / –°–±–æ—Ä–∫–∞
- `shipped` ‚Äî –û—Ç–ø—Ä–∞–≤–ª–µ–Ω (–µ—Å—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä)
- `cancelled` ‚Äî –û—Ç–º–µ–Ω–µ–Ω

---

### 2. `public.products` ‚Äî –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤

| –ö–æ–ª–æ–Ω–∫—É     | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                     |
| :---------- | :-------- | :------------------------------------------- |
| `id`        | `uuid`    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–æ–≤–∞—Ä–∞                         |
| `name`      | `text`    | –ù–∞–∑–≤–∞–Ω–∏–µ                                     |
| `slug`      | `text`    | URL-friendly –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä                   |
| `price`     | `numeric` | –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏) |
| `old_price` | `numeric` | –¶–µ–Ω–∞ –¥–æ —Å–∫–∏–¥–∫–∏                               |
| `in_stock`  | `boolean` | –ù–∞–ª–∏—á–∏–µ                                      |

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)

1.  **–ü—Ä–æ—Ñ–∏–ª–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
2.  **–ó–∞–∫–∞–∑—ã**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã (`auth.uid() = user_id`).
3.  **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º –∏–º–µ—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å JWT-–∫–ª–∞–π–º–æ–º `role: 'admin'`.

## –ü–ª–∞—Ç–µ–∂–Ω—ã–π —Ü–∏–∫–ª –¥–∞–Ω–Ω—ã—Ö

1.  **–ö–ª–∏–µ–Ω—Ç**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–∞—Å—Å–∏–≤ ID —Ç–æ–≤–∞—Ä–æ–≤ –∏ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ `/api/create-payment`.
2.  **–°–µ—Ä–≤–µ—Ä**:
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–Ω—ã –≤ `products`.
    - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `orders` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending_payment`.
    - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é –≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ.
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `paymentUrl` –Ω–∞ –∫–ª–∏–µ–Ω—Ç.
3.  **–ë–∞–Ω–∫**: –ü—Ä–∏—Å—ã–ª–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/payment-webhook` –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.
4.  **–°–µ—Ä–≤–µ—Ä (Webhook)**:
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –±–∞–Ω–∫–∞.
    - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `paid`.
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.
